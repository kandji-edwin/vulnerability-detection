"""

Revision ID: 7ac5f2be7156
Revises: 
Create Date: 2022-06-30 23:52:54.552823

"""
import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision = "7ac5f2be7156"
down_revision = None
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "cpe",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("uri", sa.String(), nullable=False),
        sa.Column("cpe_version_prefix", sa.String(), server_default="", nullable=False),
        sa.Column("part", sa.String(), server_default="", nullable=False),
        sa.Column("vendor", sa.String(), server_default="", nullable=False),
        sa.Column("product", sa.String(), server_default="", nullable=False),
        sa.Column("version", sa.String(), server_default="", nullable=False),
        sa.Column("update", sa.String(), server_default="", nullable=False),
        sa.Column("edition", sa.String(), server_default="", nullable=False),
        sa.Column("language", sa.String(), server_default="", nullable=False),
        sa.Column("software_edition", sa.String(), server_default="", nullable=False),
        sa.Column("target_software", sa.String(), server_default="", nullable=False),
        sa.Column("target_hardware", sa.String(), server_default="", nullable=False),
        sa.Column("other", sa.String(), server_default="", nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_cpe_uri"), "cpe", ["uri"], unique=True)
    op.create_index(
        "ix_cpe_vendor_product_version",
        "cpe",
        ["vendor", "product", "version"],
        unique=False,
    )
    op.create_table(
        "cve",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("cve_id", sa.String(), nullable=False),
        sa.Column("severity", sa.String(), nullable=True),
        sa.Column("version", sa.String(), nullable=True),
        sa.Column("score", sa.String(), nullable=True),
        sa.Column("description", sa.String(), nullable=True),
        sa.Column("published_date", sa.DateTime(), nullable=False),
        sa.Column("last_modified_date", sa.DateTime(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_cve_cve_id"), "cve", ["cve_id"], unique=False)
    op.create_index(op.f("ix_cve_score"), "cve", ["score"], unique=False)
    op.create_table(
        "vendor",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sa.String(), nullable=True),
        sa.Column("team_identifier", sa.String(), nullable=True),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "app_bundle",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("application_name", sa.String(), nullable=False),
        sa.Column("version", sa.String(), nullable=False),
        sa.Column("bundle_version", sa.String(), nullable=False),
        sa.Column("obtained_from", sa.String(), nullable=False),
        sa.Column("bundle_identifier", sa.String(), nullable=False),
        sa.Column("process_name", sa.String(), nullable=False),
        sa.Column("path", sa.String(), nullable=False),
        sa.Column("os", sa.String(), nullable=True),
        sa.Column("verified", sa.Boolean(), nullable=True),
        sa.Column("vendor_id", sa.Integer(), nullable=True),
        sa.ForeignKeyConstraint(["vendor_id"], ["vendor.id"], ondelete="SET NULL"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("bundle_identifier", "bundle_version"),
    )
    op.create_index(
        op.f("ix_app_bundle_vendor_id"), "app_bundle", ["vendor_id"], unique=False
    )
    op.create_table(
        "cpe_cve_match",
        sa.Column("cpe_id", sa.Integer(), nullable=False),
        sa.Column("cve_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(
            ["cpe_id"],
            ["cpe.id"],
        ),
        sa.ForeignKeyConstraint(
            ["cve_id"],
            ["cve.id"],
        ),
        sa.PrimaryKeyConstraint("cpe_id", "cve_id"),
    )
    op.create_table(
        "reference_data",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("url", sa.String(), nullable=False),
        sa.Column("cve_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["cve_id"], ["cve.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("url", "cve_id"),
    )
    op.create_index(
        op.f("ix_reference_data_cve_id"), "reference_data", ["cve_id"], unique=False
    )
    op.create_table(
        "app_bundle_cpe",
        sa.Column("app_bundle_id", sa.Integer(), nullable=False),
        sa.Column("cpe_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(
            ["app_bundle_id"],
            ["app_bundle.id"],
        ),
        sa.ForeignKeyConstraint(
            ["cpe_id"],
            ["cpe.id"],
        ),
        sa.PrimaryKeyConstraint("app_bundle_id", "cpe_id"),
    )
    op.create_table(
        "device_app_info",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("tenant_id", sa.String(length=100), nullable=False),
        sa.Column("device_id", sa.String(length=128), nullable=False),
        sa.Column("app_bundle_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(
            ["app_bundle_id"], ["app_bundle.id"], ondelete="SET NULL"
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_device_app_info_app_bundle_id"),
        "device_app_info",
        ["app_bundle_id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_device_app_info_device_id"),
        "device_app_info",
        ["device_id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_device_app_info_tenant_id"),
        "device_app_info",
        ["tenant_id"],
        unique=False,
    )
    op.create_table(
        "reference_data_tag",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("tag", sa.String(), nullable=False),
        sa.Column("reference_data_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(
            ["reference_data_id"], ["reference_data.id"], ondelete="CASCADE"
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_reference_data_tag_reference_data_id"),
        "reference_data_tag",
        ["reference_data_id"],
        unique=False,
    )
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(
        op.f("ix_reference_data_tag_reference_data_id"), table_name="reference_data_tag"
    )
    op.drop_table("reference_data_tag")
    op.drop_index(op.f("ix_device_app_info_tenant_id"), table_name="device_app_info")
    op.drop_index(op.f("ix_device_app_info_device_id"), table_name="device_app_info")
    op.drop_index(
        op.f("ix_device_app_info_app_bundle_id"), table_name="device_app_info"
    )
    op.drop_table("device_app_info")
    op.drop_table("app_bundle_cpe")
    op.drop_index(op.f("ix_reference_data_cve_id"), table_name="reference_data")
    op.drop_table("reference_data")
    op.drop_table("cpe_cve_match")
    op.drop_index(op.f("ix_app_bundle_vendor_id"), table_name="app_bundle")
    op.drop_table("app_bundle")
    op.drop_table("vendor")
    op.drop_index(op.f("ix_cve_score"), table_name="cve")
    op.drop_index(op.f("ix_cve_cve_id"), table_name="cve")
    op.drop_table("cve")
    op.drop_index("ix_cpe_vendor_product_version", table_name="cpe")
    op.drop_index(op.f("ix_cpe_uri"), table_name="cpe")
    op.drop_table("cpe")
    # ### end Alembic commands ###
