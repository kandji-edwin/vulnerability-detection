from sqlalchemy import Column
from sqlalchemy import Integer
from sqlalchemy import String
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.schema import ForeignKey
from sqlalchemy.schema import Identity

Base = declarative_base()


# Table for that allows each vulnerable app on every device to be mapped to at least one cpe
class DeviceOrm(Base):
    __tablename__ = 'device_app_info'
    id = Column(Integer, Identity(always=True, start=1), primary_key=True, nullable=False)
    tenant_id = Column(String(100), index=True, nullable=False)
    device_id = Column(String(128), index=True, nullable=False)
    filepath = Column(String, nullable=False)
    cpe_row_id = Column(ForeignKey("cpes.id", ondelete="CASCADE"), nullable=False)


# Table that makes keeps track of CPEs and makes sure CPes are associated with at least one CVE
class CPEOrm(Base):
    __tablename__ = 'cpes'
    id = Column(Integer, Identity(always=True, start=1), primary_key=True, nullable=False)
    cpe_id = Column(String, index=True, nullable=False)
    cve_row_id = Column(ForeignKey("cves.cve_id", ondelete="CASCADE"), nullable=False)


# Table that simply keeps track of CVEs
class CVEOrm(Base):
    __tablename__ = 'cves'
    cve_id = Column(String, primary_key=True, nullable=False)
    severity = Column(String, nullable=False)
    version = Column(String, nullable=False)
    score = Column(String, index=True, nullable=False)
