# vulnerability-identification
Agent Vulnerability Identification Service

# Pre-commit checking
Run the following command
```
make run-pre-commit
```

If you'd instead rather pre-commit checking happen automatically, you can run
the following:
```
make pre-commit
```

Now, any time you make a commit, the checks will run. Do note that the first
check will be slow as dependencies are installed.

# Initial Setup
Create .env files for the micro services (use .env.sample as a template)
```
cp detection-service/.env.sample dectection-service/.env
cp nvd_ingestion_service/.env.sample nvd_ingestion_service/.env
```

# Initialize submodules
1. `git submodule init`
2. `git submodule update`

## Getting updates
You can stay up-to-date with the latest published changes by using the following command:
```shell
git submodule update --remote
```

For convenience, you can set an alias up to make that easier to do:
```shell
git config --global alias.update 'submodule update --remote'
```

Now you can accomplish the above with this simpler command:
```shell
git update
```

Make sure you have docker-compose installed and docker desktop is running
1. `make up`
2. `make init-db`

`make down` can be used to stop the containers

`make psql` allows you to access your dockerized database using psql

# Migrations
Migrations can be done by:
```
make generate-migrations m="<Message here>"
make run-migrations
```

# Is it working?
You can check the status of microservices by running `make status`. In addition,
you can confirm that the database is initialized correctly with the following commands:
```
make psql
local_tenant=# \d
```
Which should produce something like the following:
```
                   List of relations
 Schema |          Name          |   Type   |  Owner   
--------+------------------------+----------+----------
 public | alembic_version        | table    | postgres
 public | app_bundles            | table    | postgres
 public | cpe_cve_match          | table    | postgres
 public | cpes                   | table    | postgres
 public | cves                   | table    | postgres
 public | device_app_info        | table    | postgres
 public | device_app_info_id_seq | sequence | postgres
 public | reference_data         | table    | postgres
 public | reference_data_id_seq  | sequence | postgres
 public | reference_data_tags    | table    | postgres
(10 rows)
```

https://alembic.sqlalchemy.org/en/latest/tutorial.html
